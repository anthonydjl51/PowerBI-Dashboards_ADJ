With parent_user_def as

(
Select TOP 1 udf.id
from student as s
join userdefinedfield as udf on udf.academicyearid=s.acacemicyearid and udf.institutionid=s.institutionid
where f.name='userdef01'


),

student_source as

( 


select distinct s.id

from student as s
join studentdate sd on s.id=sd.id

where adm_date < '2024/02/01')

Merge studentuserdefinedvalue sudv 
Using (Select distinct * from student_source) as source_students
On sudv.studentid=sourcestudents.id and sudv.position=1

when not matched
then insert (studentid, userdefinedid,value,position)
values (source_students.id, (select id from parent_user_def), 'Pre Feb 1st', 1)
When Matched
Then Update set Value= 'Pre Feb 1st';


	